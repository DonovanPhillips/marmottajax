var marmottajax=function(e){return marmottajax.get(e)};marmottajax.json=function(e){if(!e){return false}var t=e;if(typeof e=="string"){t={url:e}}t.method="GET";t.json=true;return new marmottajax.request(t)};marmottajax.get=function(e){return new marmottajax.request(e)};marmottajax.post=function(e){if(!e){return false}var t=e;if(typeof e=="string"){t={url:e}}t.method="POST";return new marmottajax.request(t)};marmottajax.request=function(e){if(!e){return false}this.xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhr.options=e;if(typeof e=="string"){this.xhr.options={url:e}}if(this.xhr.options.method==="POST"){var t="?";for(var n in this.xhr.options.options){t+=this.xhr.options.options.hasOwnProperty(n)?"&"+n+"="+this.xhr.options.options[n]:""}}else{this.xhr.options.method="GET";this.xhr.options.url+=this.xhr.options.url.indexOf("?")<0?"?":"";for(var n in this.xhr.options.options){this.xhr.options.url+=this.xhr.options.options.hasOwnProperty(n)?"&"+n+"="+this.xhr.options.options[n]:""}}this.xhr.callbacks={then:[],error:[]};this.then=function(e){this.xhr.callbacks.then.push(e);return this};this.error=function(e){this.xhr.callbacks.error.push(e);return this};this.xhr.returnSuccess=function(e){for(var t=0;t<this.callbacks.then.length;t++){if(typeof this.callbacks.then[t]=="function"){this.callbacks.then[t](e)}}};this.xhr.returnError=function(e){for(var t=0;t<this.callbacks.error.length;t++){if(typeof this.callbacks.error[t]=="function"){this.callbacks.error[t](e)}}};this.xhr.onreadystatechange=function(){if(this.readyState===4&&this.status==200){var e=this.responseText;if(this.options.json){try{e=JSON.parse(e)}catch(t){this.returnError("invalid json");return false}}this.returnSuccess(e)}else if(this.readyState===4&&this.status==404){this.returnError("404")}else if(this.readyState===4){this.returnError("unknow")}};this.xhr.open(this.xhr.options.method,this.xhr.options.url,true);this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xhr.send(typeof t!="undefined"?t:null);return this}